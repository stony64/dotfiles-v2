#!/usr/bin/env bash
#
# ┌───────────────────────────────────────────────────────────────────────────┐
# │ FILE: home/.bashexports                                                   │
# │ ZWECK: Globale Umgebungsvariablen für Tools, Editoren und Locales         │
# │ STANDARDS: Bash >= 4.0, Google Shell Style Guide                          │
# └───────────────────────────────────────────────────────────────────────────┘

# ──────────────────────────────────────────────────────────────
# 1. STANDARD-EDITOR & VISUAL
# ──────────────────────────────────────────────────────────────
# Bestimmt, welcher Editor bei Befehlen wie 'git commit' geöffnet wird.

if [[ "${PLATFORM:-}" == "linux" ]]; then
    # Priorität Linux: micro (modern) > nano (standard) > vi (fallback)
    if command -v micro >/dev/null 2>&1; then
        export EDITOR="micro"
    elif command -v nano >/dev/null 2>&1; then
        export EDITOR="nano"
    else
        export EDITOR="vi"
    fi
else
    # Windows/Git-Bash: Integration nativer Windows-Editoren
    if command -v code >/dev/null 2>&1; then
        # VS Code im Wait-Modus für Git/CLI-Integration
        export EDITOR="code --wait"
    elif command -v notepad++.exe >/dev/null 2>&1; then
        export EDITOR="notepad++.exe -multiInst -notabbar -nosession"
    else
        export EDITOR="notepad.exe"
    fi
fi

export VISUAL="$EDITOR"

# ──────────────────────────────────────────────────────────────
# 2. PAGER & VIEWING
# ──────────────────────────────────────────────────────────────

export PAGER="less"

# LESS-Flags:
# -R: ANSI-Farben beibehalten (essentiell für farbige Logs)
# -F: Beenden, wenn Inhalt auf eine Seite passt (identisch zu 'cat')
# -X: Inhalt nach Beenden im Terminal-Buffer stehen lassen
export LESS="-RFX"

# ──────────────────────────────────────────────────────────────
# 3. SPRACHE & LOCALES (v1.2.1 STANDARD)
# ──────────────────────────────────────────────────────────────
# Erzwingt UTF-8, um Probleme mit Umlauten und Sonderzeichen zu vermeiden.

if [[ "${PLATFORM:-}" == "linux" ]]; then
    # C.UTF-8 ist der schlanke Standard für Server und Container
    export LANG="C.UTF-8"
    export LC_ALL="C.UTF-8"
else
    # Windows Git-Bash nutzt oft en_US für Systemnachrichten
    export LANG="en_US.UTF-8"
    export LC_ALL="en_US.UTF-8"
fi

# ──────────────────────────────────────────────────────────────
# 4. TOOL-SPEZIFISCHE EXPORTE
# ──────────────────────────────────────────────────────────────

# GPG-Signing für Git (falls vorhanden)
if command -v gpg >/dev/null 2>&1; then
    export GPG_TTY=$(tty)
fi

# Verhindert, dass Node.js/npm bei Fehlern das Terminal mit Stacktraces flutet
export NODE_OPTIONS="--no-warnings"

# ──────────────────────────────────────────────────────────────
# 5. LOKALE ERWEITERUNGEN
# ──────────────────────────────────────────────────────────────
# Hier können API-Keys (z.B. GITHUB_TOKEN) oder Host-spezifische
# Variablen definiert werden, ohne sie ins öffentliche Repo zu pushen.

if [[ -f "$HOME/.bash_exports_local" ]]; then
    # shellcheck disable=SC1091
    source "$HOME/.bash_exports_local"
fi

true
